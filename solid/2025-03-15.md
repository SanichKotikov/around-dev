Пример оптимизации EmojiList в SolidJS

В прошлом посте я рассказывал про оптимизацию средствами CSS, на примере конкретного свойства. Пришло время поговорить и про JS.

Возьмём всё тот же код с использованием SolidJS: https://github.com/SanichKotikov/solid-emoji-demo

_Примечание: В этот раз все цифры будут указаны с учётом 4х кратного замедления, т.к. они ближе к цифрам в реальных условиях. Плюс, замеры производились на production сборке._

В качестве отправной точки возьмём код, в котором стили объявлены через свойство `style` из JS:

```
Script        ~54 ms
Recalculate:  ~7 ms
Layout:       ~19 ms
PrePaint:     ~2 ms
Paint:        ~7 ms
```

Выносим всю стилизацию, кроме `contain-intrinsic-height`, из JS в CSS файл, и сразу получаем следующий результат:

```
Script        ~24 ms
Recalculate:  ~3 ms
Layout:       ~19 ms
PrePaint:     ~1.3 ms
Paint:        ~6.3 ms
```

Выполнение JS кода, а также recalculate style, сократились примерно в двое. Кстати, если использовать `@emotion/css`, то это практически ни как не повлияет на изначальные цифры. **Делаем очевидный вывод — стилизация через JS (в рантайме) имеет свои накладные расходы.**

Интересно, что если унести и `contain-intrinsic-height` в CSS, само собой с каким-то усреднённым значением, то это может замедлить Layout до `~24 ms`.

Как ещё можно сократить время выполнения JS в таком, казалось бы, простом коде? Избавимся от “конструкций” библиотеки (в нашем случае SolidJS), там где это возможно.

Во-первых, избавимся от отдельного компонента `EmojiButton`, т.к. в нём нет ни какого практического смысла. Запомните, чем больше в проекте компонентов, тем он медленнее, в том числе и на этапе сборки.

Во-вторых, заменим `For` на обычный `.map`, т.к. список emoji статический, и в этом компоненте тут нет какого-то особого смысла. Попутно можно удалить и `createMemo`, по той же причине. Кстати, компонент `Index` медленнее чем `For`.

В итоге, получаем ещё немного прироста в выполнении JS:

```
Script        ~19 ms
```
