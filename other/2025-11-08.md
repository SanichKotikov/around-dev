# Несколько слов о TanStack Query (React Query)

В документации говорится, что TanStack Query _упрощает_ получение, кеширование, синхронизацию и обновление данных. В целом это так, но есть нюансы.

Рассмотрим базовый пример:

```jsx
import { useQuery } from "@tanstack/react-query";

export function Example() {
  const query = useQuery({
    queryKey: ['example', 'data'],
    queryFn: () => {
      return fetch('/api/example/data')
        .then((res) => res.json());
    },
  });

  if (query.isLoading) return 'Loading...';
  if (query.error) return 'An error has occurred';

  return <div>{query.data}</div>;
}
```

Казалось бы, всё просто: есть состояние загрузки, ошибка и данные. Но давайте разберёмся чуть глубже.

Как вы думаете, столько параметров состояния возвращает `useQuery`? Вот неполный список: status, isPending, isSuccess, isError, isLoadingError, isRefetchError, isFetched, isFetchedAfterMount, fetchStatus, isFetching, isRefetching, isLoading, isInitialLoading… Сможете без документации разобраться, чем отличаются, например, isPending, isLoading и isFetching?

А сколько методов возвращает useQuery? Всего один — `refetch`, хотя библиотека предоставляет и другие необходимые функции, например `setQueryData` (для обновления данных) и `invalidateQueries` (для инвалидации).

Но чтобы ими воспользоваться, нужно знать `queryKey` запроса, а также получить инстанс `queryClient` через хук `useQueryClient` (или прямой импорт):

```jsx
import { useQuery, useQueryClient } from "@tanstack/react-query";

function getExampleApiKey() {
  return ['example', 'data'];
}

export function Example() {
  const queryClient = useQueryClient();

  const query = useQuery({
    queryKey: getExampleApiKey(),
    queryFn: () => {
      return fetch('/api/example/data')
        .then((res) => res.json());
    },
  });

  function handleInvalidate() {
    void queryClient.invalidateQueries({
      queryKey: getExampleApiKey(),
    });
  }

  if (query.isLoading) return 'Loading...';
  if (query.error) return 'An error has occurred';

  return (
    <div>
      <div>{query.data}</div>
      <button onClick={handleInvalidate}>
        Update
      </button>
    </div>
  );
}
```

Как-то многовато кода добавилось из-за одной простой операции…

TanStack Query действительно упрощает определённые операции, но у всего есть своя цена, и понимать её, как обычно, начинаешь только после длительного использования. Большое количество возможностей в одном инструменте — это как плюс, так и минус (особенно для больших команд). К тому же, «из коробки» вам придётся писать довольно много шаблонного кода, а в последствии думать как его сокращать.
