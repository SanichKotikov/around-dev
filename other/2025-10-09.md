# Как проверить формат файла и почему фильтра по accept и type не достаточно

Начнём с самого простого варианта:

```jsx
<input type="file" accept="image/*" />
```

Несмотря на вполне конкретные указания, что input может принимать только изображения, операционные системы предоставляют возможность обойти это и выбрать любой файл. Так что не стоит воспринимать параметр accept как полноценный фильтр, по факту это всего лишь подсказка.

Вариант «побогаче» — drag & drop. Тут пользователь вообще ни как не ограничен и нужно программно фильтровать список dataTransfer.items, во-первых, по kind а во-вторых по type (он же MIME тип).

Но даже фильтра по type, на самом деле, может быть не достаточно, т.к. под видом изображения можно загрузить что угодно, например вредоносный код. Помимо безопасности, это вопрос предсказуемости и стабильности системы, а также консистентности данных.

Самое простое, что можно сделать, это проверить сигнатуру файла:

```typescript
function getSignature(buffer: ArrayBuffer, length = 4): string {
  return Array.from(new Uint8Array(buffer.slice(0, length)))
    .map(num => num.toString(16))
    .join("");
}

file.arrayBuffer()
  .then(getSignature)
  .then(checkSignature);
```

Данные необходимых вам сигнатур можно найти в интернетах, например [тут](https://en.wikipedia.org/wiki/List_of_file_signatures). Остальное — дело техники.

П.С. Где делать подобные проверки, на клиенте или на сервере (а возможно и там и там), зависит от задачи.
